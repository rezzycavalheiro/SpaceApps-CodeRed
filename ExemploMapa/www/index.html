<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="css/onsenui.css">
    <link rel="stylesheet" href="css/onsen-css-components.min.css">
    <script src="js/onsenui.min.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript">
    ons.disableAutoStyling();
    var map;
    document.addEventListener("deviceready", function() {
      var div = document.getElementById("map_canvas");
      document.getElementById("teste").style.marginLeft = "80%";

      // Create a Google Maps native view under the map_canvas div.
      map = plugin.google.maps.Map.getMap(div);

      map.one(plugin.google.maps.event.MAP_READY, onMapInit);

    }, false);

    function onMapInit(){
        navigator.geolocation.getCurrentPosition(function (localizacao) {
            map.animateCamera({
                target: { lat: localizacao.coords.latitude, lng: localizacao.coords.longitude },
                zoom: 17
                //tilt: 60,
                //bearing: 140,
                //duration: 5000
            });

            var marcador = map.addMarker({
                position: { lat: localizacao.coords.latitude, lng: localizacao.coords.longitude },
                title: "Você está aqui",
                snippet: "E eu não estou brincando",
                //icon: image,
                animation: plugin.google.maps.Animation.BOUNCE
            });

            marcador.showInfoWindow();
        }, console.error);

        $.get("http://192.168.137.1:8080/teste/getHello", function(result){

        }).done(function(response){
            var image = "https://media.eadbox.com/system/uploads/medium/file/5dab61d12aef050033caef09/fire.png";
            var data = [];
            response.map(linha => {
                console.log("iterando dados... " + new Date().toLocaleString('pt-BR'));
                var obj = {
                    position: { lat: linha.latitude, lng: linha.longitude },
                    title: "Possível foco de incêndio",
                    //title: "FRP: " + linha.frp,
                    //snippet: "Confiança: " + linha.confianca + "%",
                    icon: image
                };
                data.push(obj);
                // console.log("mapeando... " + new Date().toLocaleString('pt-BR'));
                // map.addMarker({
                //     position: { lat: linha.latitude, lng: linha.longitude },
                //     title: "FRP: " + linha.frp,
                //     snippet: "Confiança: " + linha.confianca + "%",
                //     icon: image
                //     //animation: plugin.google.maps.Animation.BOUNCE
                // });
            })
            var baseArray = new plugin.google.maps.BaseArrayClass(data);
            baseArray.map(function (locationData) {
                console.log("adicionando marker... " + new Date().toLocaleString('pt-BR'));
                var marker = map.addMarker(locationData);
                marker.on(plugin.google.maps.event.MARKER_CLICK, function() {
                    //event.preventDefault();
                    event.stopPropagation();
                });
                marker.off(plugin.google.maps.event.MARKER_CLICK, function() {
                    //event.preventDefault();
                    event.stopPropagation();
                });
            });
        }).fail(function(response){
            console.log("deu ruim :(");
        })

    }

    </script>
    <style type="text/css">
    #map_canvas { /* Must bigger size than 100x100 pixels */
      width: 100%;
      height: 610px;
      position: absolute !important;
    }
    .container {
        background-color: #efeff4;
    }
    .pag2 { /* Must bigger size than 100x100 pixels */
      width: 100%;
      height: 610px;
      position: absolute !important;
      background-color: yellow;
    }
    </style>
  </head>
  <body>
        <ons-navigator swipeable id="navigator" page="principal">
            <template id="principal">
                <ons-page id="principal">
                    <ons-tabbar animation="slide" swipeable position="auto">
                            <ons-tab page="pag1" label="Pag 1" icon="fa-utensils" active></ons-tab>
                            <ons-tab page="pag2" label="Pag 2" icon="fa-edit"></ons-tab>
                            <ons-tab page="pag3" label="Pag 3" icon="fa-user-circle"></ons-tab>
                    </ons-tabbar>
                </ons-page>
            </template>

            <template id="pag1">
                <ons-page id="pag1">
                    <div class="container">
                        <div id="map_canvas">
                                <!-- <button id="button">Click me!</button> -->
                        </div>
                    </div>
                </ons-page>
            </template>

            <template id="pag2">
                <ons-page id="pag2">
                    <div class="pag2">
                        <div style="height: 50px; width: 100%; background-image: linear-gradient(to right, white, yellow , red); border-radius: 30px">
                        </div>
                        
                        <div id="teste" style="height: 50px; width: 2px; background-color: black; margin-top: -50px;"></div>
                    </div>
                </ons-page>
            </template>

            <template id="pag3">
                <ons-page id="pag3">

                </ons-page>
            </template>
        </ons-navigator>
  </body>
</html>